{"ast":null,"code":"var _jsxFileName = \"E:\\\\Intern Cars24\\\\Roadtrip-planner\\\\Roadtrip-planner\\\\frontend\\\\src\\\\context\\\\AuthContext.js\",\n  _s = $RefreshSig$();\nimport React, { createContext, useState, useEffect, useCallback } from 'react';\nimport { jwtDecode } from 'jwt-decode';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nconst AuthProvider = ({\n  children\n}) => {\n  _s();\n  const [auth, setAuth] = useState({\n    token: null,\n    user: null,\n    isAuthenticated: false,\n    loading: true\n  });\n  const loadUserFromToken = useCallback(() => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      try {\n        const decodedUser = jwtDecode(token);\n        const currentTime = Date.now() / 1000;\n        if (decodedUser.exp < currentTime) {\n          console.log('Token expired, removing from storage');\n          localStorage.removeItem('token');\n          setAuth({\n            token: null,\n            user: null,\n            isAuthenticated: false,\n            loading: false\n          });\n        } else {\n          setAuth({\n            token: token,\n            user: decodedUser.user,\n            isAuthenticated: true,\n            loading: false\n          });\n        }\n      } catch (err) {\n        console.error('Invalid token:', err);\n        localStorage.removeItem('token');\n        setAuth({\n          token: null,\n          user: null,\n          isAuthenticated: false,\n          loading: false\n        });\n      }\n    } else {\n      setAuth({\n        token: null,\n        user: null,\n        isAuthenticated: false,\n        loading: false\n      });\n    }\n  }, []);\n  useEffect(() => {\n    loadUserFromToken();\n  }, [loadUserFromToken]);\n  const login = token => {\n    try {\n      localStorage.setItem('token', token);\n      const decodedUser = jwtDecode(token);\n      setAuth({\n        token: token,\n        user: decodedUser.user,\n        isAuthenticated: true,\n        loading: false\n      });\n    } catch (err) {\n      console.error('Error during login:', err);\n      logout();\n    }\n  };\n  const logout = () => {\n    localStorage.removeItem('token');\n    setAuth({\n      token: null,\n      user: null,\n      isAuthenticated: false,\n      loading: false\n    });\n  };\n\n  // Auto-refresh token before expiry (optional enhancement)\n  useEffect(() => {\n    if (auth.token) {\n      try {\n        const decodedToken = jwtDecode(auth.token);\n        const timeUntilExpiry = decodedToken.exp * 1000 - Date.now();\n\n        // If token expires in less than 5 minutes, we could refresh it\n        if (timeUntilExpiry < 5 * 60 * 1000 && timeUntilExpiry > 0) {\n          console.log('Token expires soon, consider refreshing');\n        }\n      } catch (err) {\n        console.error('Error checking token expiry:', err);\n      }\n    }\n  }, [auth.token]);\n  const contextValue = {\n    auth,\n    login,\n    logout,\n    isLoading: auth.loading\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: contextValue,\n    children: !auth.loading && children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 9\n  }, this);\n};\n_s(AuthProvider, \"W8m6mXECcnrS126kiQzg796BnP0=\");\n_c = AuthProvider;\nexport { AuthContext, AuthProvider };\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useState","useEffect","useCallback","jwtDecode","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","_s","auth","setAuth","token","user","isAuthenticated","loading","loadUserFromToken","localStorage","getItem","decodedUser","currentTime","Date","now","exp","console","log","removeItem","err","error","login","setItem","logout","decodedToken","timeUntilExpiry","contextValue","isLoading","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["E:/Intern Cars24/Roadtrip-planner/Roadtrip-planner/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect, useCallback } from 'react';\nimport { jwtDecode } from 'jwt-decode';\n\nconst AuthContext = createContext();\n\nconst AuthProvider = ({ children }) => {\n    const [auth, setAuth] = useState({\n        token: null,\n        user: null,\n        isAuthenticated: false,\n        loading: true,\n    });\n\n    const loadUserFromToken = useCallback(() => {\n        const token = localStorage.getItem('token');\n        if (token) {\n            try {\n                const decodedUser = jwtDecode(token);\n                const currentTime = Date.now() / 1000;\n\n                if (decodedUser.exp < currentTime) {\n                    console.log('Token expired, removing from storage');\n                    localStorage.removeItem('token');\n                    setAuth({ token: null, user: null, isAuthenticated: false, loading: false });\n                } else {\n                    setAuth({\n                        token: token,\n                        user: decodedUser.user,\n                        isAuthenticated: true,\n                        loading: false,\n                    });\n                }\n            } catch (err) {\n                console.error('Invalid token:', err);\n                localStorage.removeItem('token');\n                setAuth({ token: null, user: null, isAuthenticated: false, loading: false });\n            }\n        } else {\n            setAuth({ token: null, user: null, isAuthenticated: false, loading: false });\n        }\n    }, []);\n\n    useEffect(() => {\n        loadUserFromToken();\n    }, [loadUserFromToken]);\n\n    const login = (token) => {\n        try {\n            localStorage.setItem('token', token);\n            const decodedUser = jwtDecode(token);\n            setAuth({\n                token: token,\n                user: decodedUser.user,\n                isAuthenticated: true,\n                loading: false,\n            });\n        } catch (err) {\n            console.error('Error during login:', err);\n            logout();\n        }\n    };\n\n    const logout = () => {\n        localStorage.removeItem('token');\n        setAuth({\n            token: null,\n            user: null,\n            isAuthenticated: false,\n            loading: false,\n        });\n    };\n\n    // Auto-refresh token before expiry (optional enhancement)\n    useEffect(() => {\n        if (auth.token) {\n            try {\n                const decodedToken = jwtDecode(auth.token);\n                const timeUntilExpiry = (decodedToken.exp * 1000) - Date.now();\n\n                // If token expires in less than 5 minutes, we could refresh it\n                if (timeUntilExpiry < 5 * 60 * 1000 && timeUntilExpiry > 0) {\n                    console.log('Token expires soon, consider refreshing');\n                }\n            } catch (err) {\n                console.error('Error checking token expiry:', err);\n            }\n        }\n    }, [auth.token]);\n\n    const contextValue = {\n        auth,\n        login,\n        logout,\n        isLoading: auth.loading\n    };\n\n    return (\n        <AuthContext.Provider value={contextValue}>\n            {!auth.loading && children}\n        </AuthContext.Provider>\n    );\n};\n\nexport { AuthContext, AuthProvider };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}